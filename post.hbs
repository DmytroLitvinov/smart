{{!< default}}
{{!-- The tag above means: insert everything in this file
into the {body} of the default.hbs template --}}

{{! Post Reading Progress }}
<div class="post-reading-progress flex-row"></div>
{{! Post Reading Progress }}

{{#post}}

{{!-- Post Header  --}}
<header class="{{^if feature_image}}post__no-img--container">{{else}}post__img">
    <img srcset="{{img_url feature_image size="s"}} 300w,
                 {{img_url feature_image size="m"}} 600w,
                 {{img_url feature_image size="l"}} 1000w,
                 {{img_url feature_image size="xl"}} 2000w" 
                 sizes="(min-width: 640px) 740px, 100vw" src="{{img_url feature_image size="l"}}"
        alt="{{title}}">
    {{/if}}
    {{^if feature_image}}
    <div class="post__no-img"></div>
    {{/if}}
</header>
{{!-- Post Header  --}}

{{!-- Main  --}}
<main id="main" class="main">
    <div class="outer-container">
        <div class="inner-container">
            <article class="{{post_class}}">
                <header class="post__header">
                    <h1 class="post__title--serif">{{title}}</h1>
                    <div class="post__author">
                        {{authors}}
                    </div>
                    <p class="post__date">
                        <time datetime="{{date format="YYYY-MM-DD"}}">{{date format="DD MMMM YYYY"}}</time>
                    {{! Tags }}
                    {{#if tags}}
                    <section class="post__tag-bar">
                        <svg aria-hidden="true">
                            <use href="#folder"></use>
                        </svg>
                        {{#foreach tags}}
                        <a href="{{url}}" class="post__tag-link">
                            <svg aria-hidden="true">
                                <use href="#hash"></use>
                            </svg>
                            <p>{{name}}</p>
                        </a>
                        {{/foreach}}
                    </section>
                    {{/if}}
                    {{! Tags }}
                </header>
                <div class="post__content">
                    {{content}}
                </div>
            </article>

            <footer class="post-footer">
                {{#has author="count:<2"}}
                <h3 class="post-footer__title-1">About the Author</h3>
                {{else}}
                <h3 class="post-footer__title-1">About the Authors</h3>
                {{/has}}
                <h3 class="post-footer__title-2">More to Read</h3>
                {{#has author="count:<2"}}
                {{#primary_author}}
                <div class="post-footer__author">
                    <div class="post-footer__author-img-container">
                        <a href="{{url}}" class="post-footer__author-img-link" aria-label="{{name}}">
                            {{#if profile_image}}
                            <img class="post-footer__author-img" src="{{img_url profile_image size="s"}}"
                                alt="{{name}}" />
                            {{else}}
                            <div class="post-footer__no-author-img"></div>
                            {{/if}}
                        </a>
                        <div>
                            <a class="post-footer__author-name" href="{{url}}">{{name}}</a>
                            <div class="post-footer__author-social">
                                {{#if twitter}}
                                <a class="twitter" data-tt="Twitter" href="{{twitter_url}}" aria-label="Twitter">
                                    <svg>
                                        <use href="#twitter"></use>
                                    </svg>
                                </a>
                                {{/if}}
                                {{#if facebook}}
                                <a class="facebook" data-tt="Facebook" href="{{facebook_url}}" aria-label="Facebook">
                                    <svg>
                                        <use href="#facebook"></use>
                                    </svg>
                                </a>
                                {{/if}}
                                {{#if website}}
                                <a class="website" data-tt="{{website}}" href="{{website}}" aria-label="{{website}}">
                                    <svg>
                                        <use href="#website"></use>
                                    </svg>
                                </a>
                                {{/if}}
                            </div>
                            {{#if location}}
                            <div class="post-footer__author-location">
                                <svg aria-hidden="true">
                                    <use href="#location"></use>
                                </svg>
                                <p>{{location}}</p>
                            </div>
                            {{/if}}
                        </div>
                    </div>
                    {{#if bio}}
                    <p>{{bio}}</p>
                    {{/if}}
                </div>
                {{/primary_author}}
                {{! If multiple authors }}
                {{else}}
                <div class="post-footer__author">
                    {{#foreach authors}}
                    <div class="post-footer__author-img-container--authors">
                        <a href="{{url}}" class="post-footer__author-img-link" aria-label="{{name}}">
                            {{#if profile_image}}
                            <img class="post-footer__author-img" src="{{img_url profile_image size="s"}}"
                                alt="{{name}}" />
                            {{else}}
                            <div class="post-footer__no-author-img">
                            </div>
                            {{/if}}
                        </a>
                        <div>
                            <a class="post-footer__author-name" href="{{url}}">{{name}}</a>
                            <div class="post-footer__author-social">
                                {{#if twitter}}
                                <a class="twitter" data-tt="Twitter" href="{{twitter_url}}" aria-label="Twitter">
                                    <svg>
                                        <use href="#twitter"></use>
                                    </svg>
                                </a>
                                {{/if}}
                                {{#if facebook}}
                                <a class="facebook" data-tt="Facebook" href="{{facebook_url}}" aria-label="Facebook">
                                    <svg>
                                        <use href="#facebook"></use>
                                    </svg>
                                </a>
                                {{/if}}
                                {{#if website}}
                                <a class="website" data-tt="{{website}}" href="{{website}}" aria-label="{{website}}">
                                    <svg>
                                        <use href="#website"></use>
                                    </svg>
                                </a>
                                {{/if}}
                            </div>
                            {{#if location}}
                            <div class="post-footer__author-location">
                                <svg aria-hidden="true">
                                    <use href="#location"></use>
                                </svg>
                                <p>{{location}}</p>
                            </div>
                            {{/if}}
                        </div>
                    </div>
                    {{/foreach}}
                </div>
                {{/has}}

                {{#prev_post in="primary_tag"}}
                <div class="related-posts related-posts-1">
                    {{> "card"}}
                </div>
                {{/prev_post}}

                {{#next_post in="primary_tag"}}
                <div class="related-posts related-posts-2">
                    {{> "card"}}
                </div>
                {{/next_post}}

                {{#get "posts" include="tags" limit="2" filter="primary_tag:-{{primary_tag.slug}}+id:-{{id}}"}}
                {{#foreach posts}}
                <div class="related-posts related-posts-3-{{@number}}">
                    {{> "card"}}
                </div>
                {{/foreach}}
                {{/get}}

            </footer>
        </div>
    </div>
</main>
{{!-- Main --}}
{{> "share"}}
{{/post}}

{{#contentFor "scripts"}}
<script>
    (function (window, document) {
        var resizeImagesInGalleries = function resizeImagesInGalleries() {
            var images = document.querySelectorAll('.kg-gallery-image img');
            images.forEach(function (image) {
                var container = image.closest('.kg-gallery-image');
                var width = image.attributes.width.value;
                var height = image.attributes.height.value;
                var ratio = width / height;
                container.style.flex = ratio + ' 1 0%';
            });
        };
        document.addEventListener('DOMContentLoaded', resizeImagesInGalleries);
    })(window, document);
</script>
{{/contentFor}}